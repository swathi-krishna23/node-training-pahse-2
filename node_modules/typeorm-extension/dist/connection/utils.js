"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.modifyConnectionOptionsForRuntimeEnvironment = exports.modifyConnectionOptionForRuntimeEnvironment = void 0;
var utils_1 = require("../utils");
function changeTStoJSPath(raw, options) {
    var isArray = Array.isArray(raw);
    var value = Array.isArray(raw) ? raw : [raw];
    options !== null && options !== void 0 ? options : (options = {});
    options.src = options.src || 'src';
    options.dist = options.dist || 'dist';
    for (var i = 0; i < value.length; i++) {
        if (typeof value[i] === 'string' &&
            value[i].indexOf(options.src) !== -1 &&
            value[i].indexOf('.ts') !== -1 &&
            value[i].indexOf(options.dist) === -1 &&
            value[i].indexOf('.js') === -1) {
            value[i] = value[i]
                .replace(options.src, options.dist)
                .replace('.ts', '.js');
        }
    }
    return isArray ? value : value[0];
}
function modifyConnectionOptionForRuntimeEnvironment(options, key, compilerOptions) {
    if (!(0, utils_1.hasOwnProperty)(options, key) || (0, utils_1.isTsNodeRuntimeEnvironment)()) {
        return options;
    }
    switch (key) {
        case 'entities':
        case 'migrations':
        case 'subscribers':
        case 'seeds':
        case 'factories': {
            options[key] = changeTStoJSPath(options[key], compilerOptions);
            break;
        }
    }
    return options;
}
exports.modifyConnectionOptionForRuntimeEnvironment = modifyConnectionOptionForRuntimeEnvironment;
function modifyConnectionOptionsForRuntimeEnvironment(connectionOptions, options) {
    var keys = Object.keys(connectionOptions);
    for (var i = 0; i < keys.length; i++) {
        connectionOptions = modifyConnectionOptionForRuntimeEnvironment(connectionOptions, keys[i], options);
    }
    return connectionOptions;
}
exports.modifyConnectionOptionsForRuntimeEnvironment = modifyConnectionOptionsForRuntimeEnvironment;
//# sourceMappingURL=utils.js.map